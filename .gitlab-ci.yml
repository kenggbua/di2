services:
  - docker:19.03

stages:
    - build
    - test

maven-build:
  stage: build
  image: maven:3-jdk-11
  before_script:
    - cd BackEnd
  script: 
    - mvn clean install -Dskip.surefire.tests

angular-build:
    stage: build
    image: trion/ng-cli
    before_script:
        - cd FrontEnd/angular
        - npm ci
    script:
        - ng build
    cache:
        key: node_modules
        paths:
        - FrontEnd/angular/node_modules
    tags:
        - docker

angular-test-karma:
    stage: test
    image: trion/ng-cli-karma
    allow_failure: false
    needs: ["angular-build"]
    before_script:
        - cd FrontEnd/angular
    script:
        - ng test --watch false
    cache:
        key: node_modules
        paths:
        - FrontEnd/angular/node_modules
    tags:
        - docker

angular-test-e2e:
    stage: test
    image: trion/ng-cli-e2e
    allow_failure: false
    needs: ["angular-build"]
    before_script:
        - cd FrontEnd/angular
    script:
        - ng e2e
    cache:
        key: node_modules
        paths:
        - FrontEnd/angular/node_modules
    tags:
        - docker

angular-test-lint:
    stage: test
    image: trion/ng-cli
    needs: ["angular-build"]
    before_script:
        - cd FrontEnd/angular
    script:
        - ng lint
    cache:
        key: node_modules
        paths:
        - FrontEnd/angular/node_modules
    tags:
        - docker

angular-lint-sonar:
    stage: test
    image: trion/ng-cli
    needs: ["angular-build"]
    before_script:
        - cd FrontEnd/angular
    script:
        - npm install -g sonarqube-scanner
        - >
            sonar-scanner
            -Dsonar.projectKey=demo
            -Dsonar.organization=everflux-github
            -Dsonar.host.url=https://sonarcloud.io
            -Dsonar.login=covfefe
            -Dsonar.typescript.lcov.reportPaths=coverage/lcov/lcov.info
            -Dsonar.sourceEncoding=UTF-8
            -Dsonar.sources=src/app
            -Dsonar.exclusions=**/node_modules/**,**/*.spec.ts
            -Dsonar.tests=src/app
            -Dsonar.test.inclusions=**/*.spec.ts
    cache:
        key: node_modules
        paths:
        - FrontEnd/angular/node_modules
    tags:
        - docker







